@{
	var pageName = (string)ViewBag.PageName;
	var lang = (string)ViewBag.Lang;
	if(!string.IsNullOrEmpty(lang))
	{
		pageName = $"{pageName}?lang={lang}";
	}
}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.1.0/github-markdown.min.css">
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/markdown-it/dist/markdown-it.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.js"></script>
<link href="~/css/md.css" rel="stylesheet" />

@if(lang=="fa")
{
	<div style="direction:rtl">
		<div id="html-output"></div>
	</div>
}
else
{
	<div id="html-output"></div>
}

<script>

	async function loadMarkdown() {
		try {
			var url = '/md/@Html.Raw(pageName)';
			
			const response = await fetch(url);
			if (!response.ok) {
				throw new Error(`Error: ${response.status}`);
			}
			const markdownText = await response.text(); 
			var md = window.markdownit({
				highlight: function (code, lang) {
					return `<div class="code-frame"><pre class="language-${lang}"><button class="copy-button">کپی</button><code class="language-${lang}">${md.utils.escapeHtml(code)}</code></pre></div>`;
				}
			});
			
			var html = md.render(markdownText);
			
			html = html.replace("<table>", "<table class='table table-striped table-hover'>");
			
			document.getElementById('html-output').innerHTML = html;

			addCopy();
		} catch (error) {
			console.error('Error loading markdown:', error);
			document.getElementById('html-output').innerText = 'Error loading content.';
		}
	}
	function addCopy() {
		document.querySelectorAll('.copy-button').forEach(button => {
			button.addEventListener('click', () => {
				
				const codeBlock = button.nextElementSibling.innerText;
				navigator.clipboard.writeText(codeBlock)
					.then(() => {
						button.innerText = "کپی شد!";
						setTimeout(() => {
							button.innerText = "کپی";
						}, 2000);
					})
					.catch(err => console.log('خطا در کپی کردن:', err));
			});
		});
	}
	loadMarkdown();
</script>
